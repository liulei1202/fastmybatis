<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>fastmybatis开发文档</title>
        <link rel="stylesheet" href="./static/highlight/styles/vs.css">
		<script src="./static/highlight/highlight.pack.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" type="text/css" href="./static/github2-rightpart.css" media="all">
        <link rel="stylesheet" type="text/css" href="./static/github1-contents.css">
        <link rel="stylesheet" href="./static/zTreeStyle.css" type="text/css">
        <style>
            .ztree li a.curSelectedNode {
                padding-top: 0px;
                background-color: #FFE6B0;
                color: black;
                height: 16px;
                border: 1px #FFB951 solid;
                opacity: 0.8;
            }
            .ztree{
                overflow: auto;
                height:100%;
                min-height: 200px;
                top: 0px;
            }
            .task-list{list-style-type: disc !important;}
            .container{margin: 0px !important;}
            #readme .markdown-body, #readme .plain{border:0px !important;}
            .markdown-body{font-size:14px;}
        </style>
    </head>
    <body>
        <div>
            <div style="width:30%;">
                <ul id="tree" class="ztree" style="overflow: auto; position: fixed; z-index: 2147483647; border: 0px none; left: 0px; bottom: 0px;">
                <!-- 目录内容在网页另存为之后将插入到此处 -->
                </ul>
            </div>
            <div id="readme" style="width:70%;margin-left:25%;">
                <article class="markdown-body">


<!-- 请把你的html正文部分粘贴到此处，在浏览器中打开之后将会自动生成目录。如果想要将目录保留并嵌入到此文档中，只需在浏览器中“另存为->网页，全部”即可 -->
<div class="md-preview markdown-body" data-provider="markdown-preview" style="width: 100%; height: 15376px; resize: none;"><h1>简介</h1>
<p>fastmybatis是一个mybatis开发框架，其宗旨为：简单、快速、有效。</p>
<ul>
<li>零配置快速上手</li>
<li>无需编写xml文件即可完成CRUD操作</li>
<li>支持mysql，sqlserver，oracle，postgresql,sqlite</li>
<li>支持自定义sql，sql语句可写在注解中或xml中</li>
<li>支持与spring-boot集成，依赖starter即可</li>
<li>轻量级，无侵入性，是官方mybatis的一种扩展</li>
</ul>
<h1>快速开始（springboot）</h1>
<ul>
<li>新建一个springboot项目</li>
<li>pom.xml添加fastmybatis-spring-boot-starter</li>
</ul>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>net.oschina.durcframework<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>fastmybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>最新版本（见changelog.md）<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
</code></pre>
<ul>
<li>假设数据库有张<code>t_user</code>表，添加对应的实体类<code>TUser.java</code>和Mapper<code>TUserMapper.java</code>(可用fastmybatis-generator来生成)</li>
<li>在<code>application.propertis</code>中配置数据库连接</li>
<li>编写测试用例</li>
</ul>
<pre><code class="hljs"><span class="hljs-annotation">@Autowired</span>
TUserMapper mapper;
    
<span class="hljs-comment">// 根据主键查询</span>
<span class="hljs-annotation">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testGetById</span><span class="hljs-params">()</span> </span>{
    TUser user = mapper.getById(<span class="hljs-number">3</span>);
    System.out.println(user);
}
</code></pre>
<h1>查询</h1>
<p>本小节主要讲解fastmybatis的查询功能。fastmybatis提供丰富的查询方式，满足日常查询所需。</p>
<h2>分页查询</h2>
<h3>方式1</h3>
<p>前端传递两个分页参数pageIndex，pageSize</p>
<pre><code class="hljs">	<span class="hljs-comment">// http://localhost:8080/page1?pageIndex=1&amp;pageSize=10</span>
	@GetMapping(<span class="hljs-string">"page1"</span>)
	public <span class="hljs-keyword">List</span>&lt;TUser&gt; page1(int pageIndex,int pageSize) {
		<span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = new <span class="hljs-keyword">Query</span>();
		<span class="hljs-keyword">query</span>.page(pageIndex, pageSize);
		<span class="hljs-keyword">List</span>&lt;TUser&gt; <span class="hljs-keyword">list</span> = mapper.<span class="hljs-keyword">list</span>(<span class="hljs-keyword">query</span>);
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">list</span>;
	}
</code></pre>
<h3>方式2</h3>
<p>PageParam里面封装了pageIndex，pageSize参数</p>
<pre><code class="hljs">	<span class="hljs-comment">// http://localhost:8080/page2?pageIndex=1&amp;pageSize=10</span>
	@GetMapping(<span class="hljs-string">"page2"</span>)
	public <span class="hljs-keyword">List</span>&lt;TUser&gt; page2(PageParam param) {
		<span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = param.toQuery();
		<span class="hljs-keyword">List</span>&lt;TUser&gt; <span class="hljs-keyword">list</span> = mapper.<span class="hljs-keyword">list</span>(<span class="hljs-keyword">query</span>);
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">list</span>;
	}
</code></pre>
<h3>返回结果集和总记录数</h3>
<p>方式1和方式2只能查询结果集，通常我们查询还需返回记录总数并返回给前端，fastmybatis的处理方式如下：</p>
<pre><code class="hljs">// http://localhost:<span class="hljs-number">8080</span>/page3?pageIndex=<span class="hljs-number">1</span>&amp;pageSize=<span class="hljs-number">10</span>
	@<span class="hljs-type">GetMapping</span>(<span class="hljs-string">"page3"</span>)
	public <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>,<span class="hljs-type">Object</span>&gt; page3(<span class="hljs-type">PageParam</span> param) {
		<span class="hljs-type">Query</span> query = param.toQuery();
		<span class="hljs-type">List</span>&lt;<span class="hljs-type">TUser</span>&gt; list = mapper.list(query);
		long total = mapper.getCount(query);
		
		<span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>,<span class="hljs-type">Object</span>&gt; <span class="hljs-literal">result</span> = new <span class="hljs-type">HashMap</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Object</span>&gt;();
		<span class="hljs-literal">result</span>.put(<span class="hljs-string">"list"</span>, list);
		<span class="hljs-literal">result</span>.put(<span class="hljs-string">"total"</span>, total);
		
		<span class="hljs-keyword">return</span> <span class="hljs-literal">result</span>;
	}
</code></pre>
<p>fastmybatis提供一种更简洁的方式来处理：</p>
<pre><code class="hljs">// http://localhost:<span class="hljs-number">8080</span>/page4?pageIndex=<span class="hljs-number">1</span>&amp;pageSize=<span class="hljs-number">10</span>
	@<span class="hljs-type">GetMapping</span>(<span class="hljs-string">"page4"</span>)
	public <span class="hljs-type">PageInfo</span>&lt;<span class="hljs-type">TUser</span>&gt; page4(<span class="hljs-type">PageParam</span> param) {
		<span class="hljs-type">PageInfo</span>&lt;<span class="hljs-type">TUser</span>&gt; pageInfo = <span class="hljs-type">MapperUtil</span>.query(mapper, query);
		<span class="hljs-keyword">return</span> <span class="hljs-literal">result</span>;
	}
</code></pre>
<p>PageInfo里面包含了List，total信息，还包含了一些额外信息，完整数据如下：</p>
<pre><code class="hljs">{
    <span class="hljs-string">"currentPageIndex"</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 当前页</span>
    <span class="hljs-string">"firstPageIndex"</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 首页</span>
    <span class="hljs-string">"lastPageIndex"</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 尾页</span>
    <span class="hljs-string">"list"</span>: [     <span class="hljs-comment">// 结果集</span>
        {},
        {}
    ],
    <span class="hljs-string">"nextPageIndex"</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 下一页</span>
    <span class="hljs-string">"pageCount"</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 总页数</span>
    <span class="hljs-string">"pageIndex"</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 当前页</span>
    <span class="hljs-string">"pageSize"</span>: <span class="hljs-number">10</span>, <span class="hljs-comment">// 每页记录数</span>
    <span class="hljs-string">"prePageIndex"</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 上一页</span>
    <span class="hljs-string">"start"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">"total"</span>: <span class="hljs-number">20</span> <span class="hljs-comment">// 总记录数</span>
}
</code></pre>
<h2>根据参数字段查询</h2>
<h3>查询姓名为张三的用户</h3>
<pre><code class="hljs"><span class="hljs-comment">// http://localhost:8080/sch?username=张三</span>
	@GetMapping(<span class="hljs-string">"sch"</span>)
	public <span class="hljs-keyword">List</span>&lt;TUser&gt; sch(String username) {
		<span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = new <span class="hljs-keyword">Query</span>();
		<span class="hljs-keyword">query</span>.<span class="hljs-keyword">eq</span>(<span class="hljs-string">"username"</span>, username);
		<span class="hljs-keyword">List</span>&lt;TUser&gt; <span class="hljs-keyword">list</span> = mapper.<span class="hljs-keyword">list</span>(<span class="hljs-keyword">query</span>);
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">list</span>;
	}
</code></pre>
<h3>查询姓名为张三并且拥有的钱大于100块</h3>
<pre><code class="hljs"><span class="hljs-comment">// http://localhost:8080/sch2?username=张三</span>
	@GetMapping(<span class="hljs-string">"sch2"</span>)
	public <span class="hljs-keyword">List</span>&lt;TUser&gt; sch2(String username) {
		<span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = new <span class="hljs-keyword">Query</span>();
		<span class="hljs-keyword">query</span>.<span class="hljs-keyword">eq</span>(<span class="hljs-string">"username"</span>, username).gt(<span class="hljs-string">"money"</span>, 100);
		<span class="hljs-keyword">List</span>&lt;TUser&gt; <span class="hljs-keyword">list</span> = mapper.<span class="hljs-keyword">list</span>(<span class="hljs-keyword">query</span>);
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">list</span>;
	}
</code></pre>
<h3>查询姓名为张三并带分页</h3>
<pre><code class="hljs"><span class="hljs-comment">// http://localhost:8080/sch3?username=张三&amp;pageIndex=1&amp;pageSize=5</span>
	@GetMapping(<span class="hljs-string">"sch3"</span>)
	public <span class="hljs-keyword">List</span>&lt;TUser&gt; sch3(String username,PageParam param) {
		<span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = param.toQuery();
		<span class="hljs-keyword">query</span>.<span class="hljs-keyword">eq</span>(<span class="hljs-string">"username"</span>, username);
		<span class="hljs-keyword">List</span>&lt;TUser&gt; <span class="hljs-keyword">list</span> = mapper.<span class="hljs-keyword">list</span>(<span class="hljs-keyword">query</span>);
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">list</span>;
	}
</code></pre>
<h3>查询钱最多的前三名</h3>
<pre><code class="hljs"><span class="hljs-comment">// http://localhost:8080/sch4</span>
	@GetMapping(<span class="hljs-string">"sch4"</span>)
	public <span class="hljs-keyword">List</span>&lt;TUser&gt; sch4() {
		<span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = new <span class="hljs-keyword">Query</span>();
		<span class="hljs-keyword">query</span>.orderby(<span class="hljs-string">"money"</span>, <span class="hljs-keyword">Sort</span>.<span class="hljs-keyword">DESC</span>) <span class="hljs-comment">// 按金额降序</span>
			.page(1, 3);
		<span class="hljs-keyword">List</span>&lt;TUser&gt; <span class="hljs-keyword">list</span> = mapper.<span class="hljs-keyword">list</span>(<span class="hljs-keyword">query</span>);
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">list</span>;
	}
</code></pre>
<h3>将参数放在对象中查询</h3>
<pre><code class="hljs"><span class="hljs-comment">// http://localhost:8080/sch5?username=张三</span>
	@GetMapping(<span class="hljs-string">"sch5"</span>)
	public <span class="hljs-keyword">List</span>&lt;TUser&gt; sch5(UserParam userParam) {
		<span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = userParam.toQuery();
		<span class="hljs-keyword">query</span>.<span class="hljs-keyword">eq</span>(<span class="hljs-string">"username"</span>, userParam.getUsername());
		<span class="hljs-keyword">List</span>&lt;TUser&gt; <span class="hljs-keyword">list</span> = mapper.<span class="hljs-keyword">list</span>(<span class="hljs-keyword">query</span>);
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">list</span>;
	}
</code></pre>
<p>UserParam继承PageSortParam类，表示支持分页和排序查询</p>
<h3>使用普通bean查询</h3>
<p>假设有个User类如下</p>
<pre><code class="hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">User</span> {
	<span class="hljs-keyword">private</span> Integer id;
	<span class="hljs-keyword">private</span> String userName;

	<span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">return</span> id;
	}

	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>{
		<span class="hljs-keyword">this</span>.id = id;
	}

	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUserName</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">return</span> userName;
	}

	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserName</span><span class="hljs-params">(String userName)</span> </span>{
		<span class="hljs-keyword">this</span>.userName = userName;
	}
}
</code></pre>
<p>我们将这个类作为查询参数,那么在springmvc中可以这样写:</p>
<pre><code class="hljs">@GetMapping(path=<span class="hljs-string">"findUserBean.do"</span>)
public <span class="hljs-keyword">List</span>&lt;User&gt; findUser(User user) {
	<span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = <span class="hljs-keyword">Query</span>.build(user);
	<span class="hljs-keyword">List</span>&lt;User&gt; <span class="hljs-keyword">list</span> = dao.find(<span class="hljs-keyword">query</span>);
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">list</span>;
}
</code></pre>
<p>Query query = Query.build(user);这句是将User中的属性转换成对应条件,假设userName的值为"jim",那么会封装成一个条件where user_name=‘jim’</p>
<p>浏览器输入链接:<a href="http://localhost:8080/fastmybatis-springmvc/findUserBean.do?userName=jim">http://localhost:8080/fastmybatis-springmvc/findUserBean.do?userName=jim</a>
后台将会执行如下SQL:</p>
<pre><code class="hljs"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> id,user_name <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> t <span class="hljs-keyword">WHERE</span> t.user_name = ?
</span></code></pre>
<p>?的值为jim</p>
<h3>@Condition注解</h3>
<p>@Condition注解用来强化查询，有了这个注解可以生成各种查询条件。</p>
<p>@Condition注解有三个属性：</p>
<ul>
<li>joint：表达式之间的连接符,AND|OR,默认AND</li>
<li>column：数据库字段名，可选</li>
<li>operator：连接符枚举，存放了等于、大于、小于等连接符</li>
</ul>
<p>如果要查询id大于2的用户只需在get方法上加上一个@Condition注解即可:</p>
<pre><code class="hljs"><span class="hljs-annotation">@Condition</span>(operator=Operator.gt)
<span class="hljs-keyword">public</span> <span class="hljs-function">Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.id;
}
</code></pre>
<p>这样，当id有值时，会封装成一个<strong>where id&gt;2</strong>的条件</p>
<ul>
<li>需要注意的是，如果不指定column属性，系统会默认取get方法中属性名，然后转换成数据库字段名。如果需要指定数据库字段名的话，可以使用@Condition的column属性。</li>
</ul>
<p>public Integer get++UserName++() {
return this.userName;
}</p>
<p>这种情况下会取下划线部分字段，然后转换成数据库字段名。</p>
<pre><code class="hljs"><span class="hljs-annotation">@Condition</span>(column=<span class="hljs-string">"username"</span>) <span class="hljs-comment">// 显示指定字段名</span>
<span class="hljs-keyword">public</span> <span class="hljs-function">Integer <span class="hljs-title">getUserName</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.userName;
}
</code></pre>
<p>使用@Condition可以生产更加灵活的条件查询,比如需要查询日期为2017-12-1~2017-12-10日的记录,我们可以这样写:</p>
<pre><code class="hljs"><span class="hljs-annotation">@Condition</span>(column=<span class="hljs-string">"add_date"</span>,operator=Operator.ge)
<span class="hljs-keyword">public</span> <span class="hljs-function">Date <span class="hljs-title">getStartDate</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.startDate;
}

<span class="hljs-annotation">@Condition</span>(column=<span class="hljs-string">"add_date"</span>,operator=Operator.lt)
<span class="hljs-keyword">public</span> <span class="hljs-function">Date <span class="hljs-title">getEndDate</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.endDate;
}
</code></pre>
<p>转换成SQL语句:</p>
<pre><code class="hljs">t.add_date&gt;=<span class="hljs-string">'2017-12-1'</span> <span class="hljs-keyword">AND</span> t.add_date&lt;<span class="hljs-string">'2017-12-10'</span>
</code></pre>
<h4>IN查询</h4>
<p>假设前端页面传来多个值比如checkbox勾选多个id=[1,2],那么我们在User类里面可以用Integer[]或List&lt;Integer&gt;来接收.</p>
<pre><code class="hljs"><span class="hljs-keyword">private</span> Integer[] idArr;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setIdArr</span><span class="hljs-params">(Integer[] idArr)</span> </span>{<span class="hljs-keyword">this</span>.idArr = idArr;}

<span class="hljs-annotation">@Condition</span>(column=<span class="hljs-string">"id"</span>)
<span class="hljs-keyword">public</span> Integer[] getIdArr() {<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.idArr;}
</code></pre>
<p>这样会生成where id IN(1,2)条件。</p>
<h2>排序查询</h2>
<p>// 根据添加时间倒序</p>
<pre><code class="hljs"><span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = new <span class="hljs-keyword">Query</span>();
<span class="hljs-keyword">query</span>.orderby(<span class="hljs-string">"create_time"</span>,<span class="hljs-keyword">Sort</span>.<span class="hljs-keyword">DESC</span>);
dao.find(<span class="hljs-keyword">query</span>);
</code></pre>
<h2>多表关联查询</h2>
<p>多表关联查询使用的地方很多，比如需要关联第二张表，获取第二张表的几个字段，然后返回给前端。</p>
<p>fastmybatis的用法如下：</p>
<p>假如我们需要关联第二张表<code>user_info</code>，筛选出user_info中的城市为杭州的数据。</p>
<pre><code class="hljs"><span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = new <span class="hljs-keyword">Query</span>()
        <span class="hljs-comment">// 左连接查询,主表的alias默认为t</span>
        .join(<span class="hljs-string">"LEFT JOIN user_info t2 ON t.id = t2.user_id"</span>).page(1, 5)
        .<span class="hljs-keyword">eq</span>(<span class="hljs-string">"t2.city"</span>,<span class="hljs-string">"杭州"</span>);

<span class="hljs-keyword">List</span>&lt;TUser&gt; <span class="hljs-keyword">list</span> = mapper.<span class="hljs-keyword">list</span>(<span class="hljs-keyword">query</span>);

System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"=============="</span>);
<span class="hljs-keyword">for</span> (TUser user : <span class="hljs-keyword">list</span>) {
    System.<span class="hljs-keyword">out</span>.println(user.getId() + <span class="hljs-string">" "</span> + user.getUsername());
}
System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"=============="</span>);
</code></pre>
<h3>多表关联返回指定字段</h3>
<p>有时候不需要全部字段，需要取表1中的几个字段，然后取表2中的几个字段，fastmybatis实现方式如下：</p>
<pre><code class="hljs"><span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = new <span class="hljs-keyword">Query</span>();
<span class="hljs-comment">// 左连接查询,主表的alias默认为t</span>
<span class="hljs-keyword">query</span>.join(<span class="hljs-string">"LEFT JOIN user_info t2 ON t.id = t2.user_id"</span>);
<span class="hljs-comment">// 指定返回字段</span>
<span class="hljs-keyword">List</span>&lt;String&gt; column = Arrays.asList(<span class="hljs-string">"t2.user_id as userId"</span>, <span class="hljs-string">"t.username"</span>, <span class="hljs-string">"t2.city"</span>);
<span class="hljs-comment">// 查询结果返回到map中</span>
<span class="hljs-keyword">List</span>&lt;Map&lt;String, Object&gt;&gt; mapList = mapper.listMap(column, <span class="hljs-keyword">query</span>);
<span class="hljs-comment">// 再将map转换成实体bean</span>
<span class="hljs-keyword">List</span>&lt;UserInfoVo&gt; <span class="hljs-keyword">list</span> = MyBeanUtil.mapListToObjList(mapList, UserInfoVo.<span class="hljs-keyword">class</span>);
</code></pre>
<p>执行的SQL语句对应如下：</p>
<pre><code class="hljs">SELECT t2<span class="hljs-class">.user_id</span> as userId , t<span class="hljs-class">.username</span> , t2<span class="hljs-class">.city</span>
FROM `t_user` t 
LEFT JOIN user_info t2 ON t<span class="hljs-class">.id</span> = t2<span class="hljs-class">.user_id</span>
</code></pre>
<h2>使用@Select查询</h2>
<p>@Select注解是mybatis官方提供的一个功能，fastmybatis可以理解为是官方的一种扩展，因此同样支持此功能。
在Mapper中添加如下代码：</p>
<pre><code class="hljs"><span class="hljs-variable">@Select</span>(<span class="hljs-string">"select * from t_user where id=#{id}"</span>)
TUser <span class="hljs-function">selectById</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"id"</span>) int id);
</code></pre>
<p>编写测试用例</p>
<pre><code class="hljs"><span class="hljs-annotation">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testSelectById</span><span class="hljs-params">()</span> </span>{
    TUser user = dao.selectById(<span class="hljs-number">3</span>);

    System.out.println(user.getUsername());
}
</code></pre>
<p>对于简单的SQL，可以用这种方式实现。除了@Select之外，还有@Update，@Insert，@Delete，这里就不多做演示了。</p>
<h2>Query类详解</h2>
<p>Query是一个查询参数类，配合Mapper一起使用。</p>
<h3>参数介绍</h3>
<p>Query里面封装了一系列查询参数，主要分为以下几类：</p>
<ul>
<li>分页参数：设置分页</li>
<li>排序参数：设置排序字段</li>
<li>条件参数：设置查询条件</li>
<li>字段参数：可返回指定字段</li>
</ul>
<p>下面逐个讲解每个参数的用法。</p>
<h3>分页参数</h3>
<p>一般来说分页的使用比较简单，通常是两个参数，
pageIndex：当前页索引，pageSize：每页几条数据。
Query类使用**page(pageIdnex, pageSize)**方法来设置。
假如我们要查询第二页，每页10条数据，代码可以这样写：</p>
<pre><code class="hljs"><span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = new <span class="hljs-keyword">Query</span>();
<span class="hljs-keyword">query</span>.page(2, 10);
<span class="hljs-keyword">List</span>&lt;User&gt; <span class="hljs-keyword">list</span> = dao.find(<span class="hljs-keyword">query</span>);
</code></pre>
<p>如果要实现不规则分页，可以这样写：</p>
<pre><code class="hljs"><span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = new <span class="hljs-keyword">Query</span>();
<span class="hljs-keyword">query</span>.limit(3, 5) <span class="hljs-comment">// 对应mysql：limit 3,5</span>
</code></pre>
<h3>排序参数</h3>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-title">orderby</span><span class="hljs-params">(String sortname, Sort sort)</span></span>
</code></pre>
<p>其中sortname为数据库字段，非javaBean属性</p>
<ul>
<li>orderby(String sortname, Sort sort)则可以指定排序方式，Sort为排序方式枚举
假如要按照添加时间倒序，可以这样写：</li>
</ul>
<pre><code class="hljs"><span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = new <span class="hljs-keyword">Query</span>();
<span class="hljs-keyword">query</span>.orderby(<span class="hljs-string">"create_time"</span>,<span class="hljs-keyword">Sort</span>.<span class="hljs-keyword">DESC</span>);
mapper.<span class="hljs-keyword">list</span>(<span class="hljs-keyword">query</span>);
</code></pre>
<p>添加多个排序字段可以在后面追加：</p>
<pre><code class="hljs"><span class="hljs-keyword">query</span>.orderby(<span class="hljs-string">"create_time"</span>,<span class="hljs-keyword">Sort</span>.<span class="hljs-keyword">DESC</span>).orderby(<span class="hljs-string">"id"</span>,<span class="hljs-keyword">Sort</span>.ASC);
</code></pre>
<h3>条件参数</h3>
<p>条件参数是用的最多一个，因为在查询中往往需要加入各种条件。
fastmybatis在条件查询上面做了一些封装，这里不做太多讲解，只讲下基本的用法，以后会单独开一篇文章来介绍。感兴趣的同学可以自行查看源码，也不难理解。</p>
<p>条件参数使用非常简单，Query对象封装一系列常用条件查询。</p>
<ul>
<li>等值查询eq(String columnName, Object value)，columnName为数据库字段名，value为查询的值
假设我们要查询姓名为张三的用户，可以这样写：</li>
</ul>
<pre><code class="hljs"><span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = new <span class="hljs-keyword">Query</span>();
<span class="hljs-keyword">query</span>.<span class="hljs-keyword">eq</span>(<span class="hljs-string">"username"</span>,<span class="hljs-string">"张三"</span>);
<span class="hljs-keyword">List</span>&lt;User&gt; <span class="hljs-keyword">list</span> = mapper.<span class="hljs-keyword">list</span>(<span class="hljs-keyword">query</span>);
</code></pre>
<p>通过方法名即可知道eq表示等于’=’，同理lt表示小于&lt;,gt表示大于&gt;</p>
<table>
<thead>
<tr>
<th>查询方式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>eq</td>
<td>等于=</td>
</tr>
<tr>
<td>gt</td>
<td>大于&gt;</td>
</tr>
<tr>
<td>lt</td>
<td>小于&lt;</td>
</tr>
<tr>
<td>ge</td>
<td>大于等于&gt;=</td>
</tr>
<tr>
<td>le</td>
<td>小于等于&lt;=</td>
</tr>
<tr>
<td>notEq</td>
<td>不等于&lt;&gt;</td>
</tr>
<tr>
<td>like</td>
<td>模糊查询</td>
</tr>
<tr>
<td>in</td>
<td>in()查询</td>
</tr>
<tr>
<td>notIn</td>
<td>not in()查询</td>
</tr>
<tr>
<td>isNull</td>
<td>NULL值查询</td>
</tr>
<tr>
<td>notNull</td>
<td>IS NOT NULL</td>
</tr>
<tr>
<td>notEmpty</td>
<td>字段不为空，非NULL且有内容</td>
</tr>
<tr>
<td>isEmpty</td>
<td>字段为NULL或者为’’</td>
</tr>
</tbody>
</table>
<p>如果上述方法还不能满足查询需求的话，我们可以使用自定sql的方式来编写查询条件，方法为：</p>
<pre><code class="hljs"><span class="hljs-keyword">Query</span> <span class="hljs-keyword">query</span> = new <span class="hljs-keyword">Query</span>();
<span class="hljs-keyword">query</span>.sql(<span class="hljs-string">" username='Jim' OR username='Tom'"</span>);
</code></pre>
<p><strong>注意</strong>：sql()方法不会处理sql注入问题，因此尽量少用。</p>
<h1>自定义SQL</h1>
<h2>方式1</h2>
<p>直接写在Mapper.java中</p>
<pre><code class="hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TUserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudMapper</span>&lt;<span class="hljs-title">TUser</span>, <span class="hljs-title">Integer</span>&gt; {</span>

    <span class="hljs-comment">// 自定义sql，官方自带，不需要写xml</span>
    <span class="hljs-javadoc">/**
     * 修改用户名
     *<span class="hljs-javadoctag"> @param</span> id
     *<span class="hljs-javadoctag"> @param</span> username
     *<span class="hljs-javadoctag"> @return</span> 返回影响行数
     */</span>
    <span class="hljs-annotation">@Update</span>(<span class="hljs-string">"update t_user set username = #{username} where id = #{id}"</span>)
    <span class="hljs-typename">int</span> updateById(<span class="hljs-annotation">@Param</span>(<span class="hljs-string">"id"</span>) <span class="hljs-typename">int</span> id, <span class="hljs-annotation">@Param</span>(<span class="hljs-string">"username"</span>) String username);
 
}
</code></pre>
<p>简单SQL可采用这种形式。</p>
<h2>方式2</h2>
<p>fastmybatis提供的Mapper已经满足大部分的操作需求，但是有些复杂的sql语句还是需要写在xml文件中。fastmybatis同样支持将sql语句写在xml中，具体配置如下：</p>
<ul>
<li>在application.properties添加一句，指定xml文件存放路径</li>
</ul>
<pre><code class="hljs">mybatis.mapper-locations=<span class="hljs-keyword">classpath</span>:<span class="hljs-regexp">/mybatis/m</span>apper<span class="hljs-comment">/*.xml
</span></code></pre>
<ul>
<li>在resources/mybatis/mapper目录下新建一个xml文件TUserMapper.xml，内容如下：</li>
</ul>
<pre><code class="hljs"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">mapper</span> <span class="hljs-attribute">namespace</span>=<span class="hljs-value">"com.mayapp.mapper.TUserMapper"</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-title">select</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"selectByName"</span> <span class="hljs-attribute">parameterType</span>=<span class="hljs-value">"String"</span> <span class="hljs-attribute">resultMap</span>=<span class="hljs-value">"baseResultMap"</span>&gt;</span>
		select * from t_user t where t.username = #{username} limit 1
	<span class="hljs-tag">&lt;/<span class="hljs-title">select</span>&gt;</span>
	
<span class="hljs-tag">&lt;/<span class="hljs-title">mapper</span>&gt;</span>
</code></pre>
<p>这个xml文件跟其它的mybatis配置文件一样，baseResultMap没有看到定义，但是确实存在，因为这个是fastmybatis提供的一个内置resultMap。</p>
<ul>
<li>在TUseroMapper.java中添加：</li>
</ul>
<pre><code class="hljs"><span class="hljs-function">TUser <span class="hljs-title">selectByName</span><span class="hljs-params">(@Param(<span class="hljs-string">"username"</span>)</span>String username)</span>;
</code></pre>
<ul>
<li>编写单元测试用例</li>
</ul>
<pre><code class="hljs"><span class="hljs-annotation">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSelectByName</span><span class="hljs-params">()</span> </span>{
    TUser user = dao.selectByName(<span class="hljs-string">"张三"</span>);

    System.out.println(user.getUsername());
}
    
</code></pre>
<h3>多文件同一个namespace</h3>
<p>在以往的开发过程中，一个Mapper对应一个xml文件（namespace）。如果多人同时在一个xml中写SQL的话会造成各种冲突（虽然能够最终被解决）。</p>
<p>fastmybatis打破这种常规，允许不同的xml文件定义相同的namespace，程序启动时会自动把他们的内容合并到同一个文件当中去。</p>
<ul>
<li>张三的UserMapper_zs.xml</li>
</ul>
<pre><code class="hljs"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">mapper</span> <span class="hljs-attribute">namespace</span>=<span class="hljs-value">"com.mayapp.mapper.TUserMapper"</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-title">select</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"selectByName"</span> <span class="hljs-attribute">parameterType</span>=<span class="hljs-value">"String"</span> <span class="hljs-attribute">resultMap</span>=<span class="hljs-value">"baseResultMap"</span>&gt;</span>
		select * from t_user t where t.username = #{username} limit 1
	<span class="hljs-tag">&lt;/<span class="hljs-title">select</span>&gt;</span>
	
<span class="hljs-tag">&lt;/<span class="hljs-title">mapper</span>&gt;</span>
</code></pre>
<ul>
<li>李四的UserMapper_ls.xml</li>
</ul>
<pre><code class="hljs"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">mapper</span> <span class="hljs-attribute">namespace</span>=<span class="hljs-value">"com.mayapp.mapper.TUserMapper"</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-title">select</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"updateUser"</span> <span class="hljs-attribute">parameterType</span>=<span class="hljs-value">"String"</span> <span class="hljs-attribute">resultMap</span>=<span class="hljs-value">"baseResultMap"</span>&gt;</span>
		update t_user set username = #{username} where id=#{id}
	<span class="hljs-tag">&lt;/<span class="hljs-title">select</span>&gt;</span>
	
<span class="hljs-tag">&lt;/<span class="hljs-title">mapper</span>&gt;</span>
</code></pre>
<p>最终会合并成</p>
<pre><code class="hljs"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">mapper</span> <span class="hljs-attribute">namespace</span>=<span class="hljs-value">"com.mayapp.mapper.TUserMapper"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 张三部分 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">select</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"selectByName"</span> <span class="hljs-attribute">parameterType</span>=<span class="hljs-value">"String"</span> <span class="hljs-attribute">resultMap</span>=<span class="hljs-value">"baseResultMap"</span>&gt;</span>
		select * from t_user t where t.username = #{username} limit 1
	<span class="hljs-tag">&lt;/<span class="hljs-title">select</span>&gt;</span>
	
	<span class="hljs-comment">&lt;!-- 李四部分 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-title">select</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"updateUser"</span> <span class="hljs-attribute">parameterType</span>=<span class="hljs-value">"String"</span> <span class="hljs-attribute">resultMap</span>=<span class="hljs-value">"baseResultMap"</span>&gt;</span>
		update t_user set username = #{username} where id=#{id}
	<span class="hljs-tag">&lt;/<span class="hljs-title">select</span>&gt;</span>
	
<span class="hljs-tag">&lt;/<span class="hljs-title">mapper</span>&gt;</span>
</code></pre>
<p>这样也体现了开闭原则，即新增一个功能只需要新增一个文件就行，不需要修改原来的文件。</p>
<p>如果SQL写多了还可以把它们进行分类，放到不同的xml中，便于管理。</p>
<p>**注：**合并动作是在启动时进行的，并不会生成一个真实的文件。</p>
<h1>字段自动填充</h1>
<h2>填充器设置</h2>
<p>假设数据库表里面有两个时间字段gmt_create,gmt_update。</p>
<p>当进行insert操作时gmt_create，gmt_update字段需要更新。当update时，gmt_update字段需要更新。</p>
<p>通常的做法是通过Entity手动设置：</p>
<pre><code class="hljs"><span class="hljs-built_in">User</span> <span class="hljs-built_in">user</span> = new <span class="hljs-built_in">User</span>();
<span class="hljs-built_ins">user</span>.setGmtCreate(new Date());
<span class="hljs-built_ins">user</span>.setGmtUpdate(new Date());
</code></pre>
<p>因为表设计的时候大部分都有这两个字段，所以对每张表都进行手动设置的话很容易错加、漏加。
fastmybatis提供了两个辅助类DateFillInsert和DateFillUpdate，用来处理添加修改时的时间字段自动填充。配置了这两个类之后，时间字段将会自动设置。</p>
<p>配置方式如下：</p>
<pre><code class="hljs"><span class="hljs-type">EasymybatisConfig</span> config = <span class="hljs-keyword">new</span> <span class="hljs-type">EasymybatisConfig</span><span class="hljs-literal">()</span>;

    config.setFills(<span class="hljs-type">Arrays</span>.asList(
			<span class="hljs-keyword">new</span> <span class="hljs-type">DateFillInsert</span><span class="hljs-literal">()</span>
			,<span class="hljs-keyword">new</span> <span class="hljs-type">DateFillUpdate</span><span class="hljs-literal">()</span>
			));
</code></pre>
<p>在spring的xml中配置如下:</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"sqlSessionFactory"</span>
		<span class="hljs-attribute">class</span>=<span class="hljs-value">"com.gitee.fastmybatis.core.ext.SqlSessionFactoryBeanExt"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"dataSource"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"dataSource"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"configLocation"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>classpath:mybatis/mybatisConfig.xml<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"mapperLocations"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-title">list</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>classpath:mybatis/mapper/*.xml<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-title">list</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!-- 以下是附加属性 --&gt;</span>
		
		<span class="hljs-comment">&lt;!-- dao所在的包名,跟MapperScannerConfigurer的basePackage一致 
			多个用;隔开
		--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"basePackage"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"com.myapp.dao"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"config"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"com.gitee.fastmybatis.core.EasymybatisConfig"</span>&gt;</span>
                                <span class="hljs-comment">&lt;!-- 定义填充器 --&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"fills"</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-title">list</span>&gt;</span>
                                        <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"com.gitee.fastmybatis.core.support.DateFillInsert"</span>/&gt;</span>
                                        <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"com.gitee.fastmybatis.core.support.DateFillUpdate"</span>/&gt;</span>
					<span class="hljs-tag">&lt;/<span class="hljs-title">list</span>&gt;</span>
				<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>
</code></pre>
<p>springboot中可以这样定义:</p>
<p>在application.properties中添加：</p>
<pre><code class="hljs">mybatis<span class="hljs-class">.fill</span><span class="hljs-class">.com</span><span class="hljs-class">.gitee</span><span class="hljs-class">.fastmybatis</span><span class="hljs-class">.core</span><span class="hljs-class">.support</span><span class="hljs-class">.DateFillInsert</span>=
mybatis<span class="hljs-class">.fill</span><span class="hljs-class">.com</span><span class="hljs-class">.gitee</span><span class="hljs-class">.fastmybatis</span><span class="hljs-class">.core</span><span class="hljs-class">.support</span><span class="hljs-class">.DateFillUpdate</span>=
</code></pre>
<p>如果要指定字段名，可以写成：</p>
<pre><code class="hljs">mybatis<span class="hljs-class">.fill</span><span class="hljs-class">.com</span><span class="hljs-class">.gitee</span><span class="hljs-class">.fastmybatis</span><span class="hljs-class">.core</span><span class="hljs-class">.support</span><span class="hljs-class">.DateFillInsert</span>=add_time
</code></pre>
<h2>自定义填充器</h2>
<p>除了使用fastmybatis默认提供的填充之外，我们还可以自定义填充。</p>
<p>自定义填充类要继承FillHandler&lt;T&gt;类。
&lt;T&gt; 表示填充字段类型，如Date，String，BigDecimal，Boolean。</p>
<h3>实战(springboot)</h3>
<p>现在有个remark字段，需要在insert时初始化为“备注默认内容”，新建一个StringRemarkFill类如下：</p>
<pre><code class="hljs">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringRemarkFill</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">FillHandler&lt;String&gt;</span> {</span>

	<span class="hljs-annotation">@Override</span>
	public <span class="hljs-type">String</span> getColumnName() {
		<span class="hljs-keyword">return</span> <span class="hljs-string">"remark"</span>;
	}

	<span class="hljs-annotation">@Override</span>
	public <span class="hljs-type">FillType</span> getFillType() {
		<span class="hljs-keyword">return</span> <span class="hljs-type">FillType</span>.<span class="hljs-type">INSERT</span>;
	}

	<span class="hljs-annotation">@Override</span>
	<span class="hljs-keyword">protected</span> <span class="hljs-type">Object</span> getFillValue(<span class="hljs-type">String</span> defaultValue) {
		<span class="hljs-keyword">return</span> <span class="hljs-string">"备注默认内容"</span>;
	}

}
</code></pre>
<p>StringRemarkFill类中有三个重写方法：</p>
<ul>
<li>getColumnName() ： 指定表字段名</li>
<li>getFillType() ： 填充方式，FillType.INSERT:仅insert时填充； FillType.UPDATE：insert，update时填充</li>
<li>getFillValue(String defaultValue) ：返回填充内容</li>
</ul>
<p>然后在application.properties中添加：</p>
<pre><code class="hljs">mybatis<span class="hljs-class">.fill</span><span class="hljs-class">.com</span><span class="hljs-class">.xx</span><span class="hljs-class">.StringRemarkFill</span>=
</code></pre>
<p>这样就配置完毕了，调用dao.save(user);时会自动填充remark字段。</p>
<h2>指定目标类</h2>
<p>上面说到StringRemarkFill填充器，它作用在所有实体类上，也就是说实体类如果有remark字段都会自动填充。这样显然是不合理的，解决办法是指定特定的实体类。只要重写FillHandler类的getTargetEntityClasses()方法即可。</p>
<pre><code class="hljs">@Override
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">Class</span>&lt;?&gt;[] <span class="hljs-title">getTargetEntityClasses</span>() {</span>
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-class"><span class="hljs-keyword">Class</span>&lt;?&gt;[] { <span class="hljs-title">TUser</span>.<span class="hljs-title">class</span> };</span>
}
</code></pre>
<p>这样就表示作用在TUser类上，多个类可以追加。最终代码如下：</p>
<pre><code class="hljs">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringRemarkFill</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">FillHandler&lt;String&gt;</span> {</span>

	<span class="hljs-annotation">@Override</span>
	public <span class="hljs-type">String</span> getColumnName() {
		<span class="hljs-keyword">return</span> <span class="hljs-string">"remark"</span>;
	}

	<span class="hljs-annotation">@Override</span>
	public <span class="hljs-type">Class</span>&lt;?&gt;[] getTargetEntityClasses() {
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">Class</span>&lt;?&gt;[] { <span class="hljs-type">TUser</span>.<span class="hljs-keyword">class</span> }; <span class="hljs-comment">// 只作用在TUser类上</span>
	}

	<span class="hljs-annotation">@Override</span>
	public <span class="hljs-type">FillType</span> getFillType() {
		<span class="hljs-keyword">return</span> <span class="hljs-type">FillType</span>.<span class="hljs-type">INSERT</span>;
	}

	<span class="hljs-annotation">@Override</span>
	<span class="hljs-keyword">protected</span> <span class="hljs-type">Object</span> getFillValue(<span class="hljs-type">String</span> defaultValue) {
		<span class="hljs-keyword">return</span> <span class="hljs-string">"备注默认内容"</span>; <span class="hljs-comment">// insert时填充的内容</span>
	}

}
</code></pre>
<p>关于自动填充的原理是基于mybatis的TypeHandler实现的，这里就不多做介绍了。感兴趣的同学可以查看FillHandler&lt;T&gt;源码。</p>
<h1>其他功能</h1>
<h2>指定外部模板</h2>
<p>fastmybatis依赖模板文件来生成mapper，默认的模板存放在fastmybatis/tpl/下，模板文件名对应某一种数据库，如mysql.vm对应mysql数据库。</p>
<p>我们可以通过更改template-classpath的值来改变模板读取的位置。默认template-classpath的值为/fastmybatis/tpl/。假如你想对mysql.vm做一些修改，那么可以按照如下步骤进行：</p>
<ol>
<li>使用解压工具解压fastmybatis.jar</li>
<li>在fastmybatis/tpl/下找到mysql.vm，拷贝一份出来，放到你的项目中的classpath下（src/main/resources）</li>
<li>在application.properties中添加一行</li>
</ol>
<pre><code class="hljs">mybatis.<span class="hljs-keyword">template</span>-classpath=/ 
</code></pre>
<p>这样在启动时会自动读取classpath根目录下的mysql.vm。控制台也会打印读取模板的信息：</p>
<pre><code class="hljs"><span class="hljs-number">2017</span>-<span class="hljs-number">12</span>-<span class="hljs-number">26</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span>:<span class="hljs-number">31.021</span>  INFO <span class="hljs-number">13476</span> --- [           main] n<span class="hljs-class">.o</span><span class="hljs-class">.d</span><span class="hljs-class">.e</span><span class="hljs-class">.ext</span><span class="hljs-class">.MapperLocationsBuilder</span>       : 使用模板:/mysql<span class="hljs-class">.vm</span>
</code></pre>
<p>如果你的项目是springmvc，采用xml配置形式，前两步不变，第三步改为：</p>
<pre><code class="hljs"><span class="hljs-comment">&lt;!-- 替换org.mybatis.spring.SqlSessionFactoryBean --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"sqlSessionFactory"</span>
		<span class="hljs-attribute">class</span>=<span class="hljs-value">"net.oschina.durcframework.fastmybatis.ext.SqlSessionFactoryBeanExt"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"dataSource"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"dataSource"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"configLocation"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>classpath:mybatis/mybatisConfig.xml<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"mapperLocations"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-title">list</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>classpath:mybatis/mapper/*.xml<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-title">list</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!-- 以下是附加属性 --&gt;</span>
		
		<span class="hljs-comment">&lt;!-- dao所在的包名,跟MapperScannerConfigurer的basePackage一致 
			多个用;隔开
		--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"basePackage"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"com.myapp.dao"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"config"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"net.oschina.durcframework.fastmybatis.fastmybatisConfig"</span>&gt;</span>
				<span class="hljs-comment">&lt;!-- 指定外部模板 --&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"templateClasspath"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"/"</span>/&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>
</code></pre>
</div>
<!-- ***********************************************************内容分割线****************************************************************** -->
                </article>
            </div>
        </div>
    <script src="./static/jquery-1.10.2.min.js"></script>
    <script src="./static/jquery.ztree.all-3.5.min.js"></script>
    <script src="./static/jquery.ztree_toc.min.js"></script>
    <script type="text/javascript">
    var title = document.title;
        $(document).ready(function(){
            $('#tree').ztree_toc({
            	_header_nodes: [{ id:1, pId:0, name:title,open:false}],  // 第一个节点
            	ztreeSetting: {
            		view: {
        				dblClickExpand: false,
        				showLine: true,
        				showIcon: false,
        				selectedMulti: false
        			},
        			data: {
        				simpleData: {
        					enable: true,
        					idKey : "id",
        					pIdKey: "pId"
        					// rootPId: "0"
        				}
        			},
            		callback: {
        				beforeClick: function(treeId, treeNode) {
        					$('a').removeClass('curSelectedNode');
        					if(treeNode.id == 1){
        						$('body').scrollTop(0);
        					}
        					if($.fn.ztree_toc.defaults.is_highlight_selected_line == true) {
        						$('#' + treeNode.id).css('color' ,'red').fadeOut("slow" ,function() {
        							$(this).show().css('color','black');
        						});
        					}
        				}
        			}            		
            	},
                is_auto_number:true, // 菜单是否显示编号，如果markdown标题没有数字标号可以设为true
                documment_selector:'.markdown-body',
                is_expand_all: true // 菜单全部展开
            });
            // 代码高亮
            $('.highlight').each(function(i, block) {
          	    hljs.highlightBlock(block);
          	});
        });
    </script>
    </body>
</html>